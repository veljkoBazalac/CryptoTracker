//
//  MarketData.swift
//  CryptoTracker
//
//  Created by VELJKO on 12.11.22..
//

import Foundation

// MARK: - JSON DATA
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON RESPONSE:
 {
   "data": {
     "active_cryptocurrencies": 13238,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 606,
     "total_market_cap": {
       "btc": 52584952.99474092,
       "eth": 701049294.9560869,
       "ltc": 14851740161.675089,
       "bch": 8826595016.462202,
       "bnb": 3114491737.2973547,
       "eos": 981909072921.328,
       "xrp": 2372177764099.215,
       "xlm": 9576754609832.812,
       "link": 138287242531.44547,
       "dot": 155685706964.13507,
       "yfi": 148491656.94301063,
       "usd": 888152193731.1842,
       "aed": 3262183007574.6416,
       "ars": 142480332465161.8,
       "aud": 1324989850217.8699,
       "bdt": 90739644454537.9,
       "bhd": 334143282782.1276,
       "bmd": 888152193731.1842,
       "brl": 4729765692496.049,
       "cad": 1178622368690.9712,
       "chf": 837173145963.2097,
       "clp": 791308078526733.9,
       "cny": 6313163423480.031,
       "czk": 20835695204056.1,
       "dkk": 6380041283667.955,
       "eur": 856239997258.2307,
       "gbp": 751906982756.2375,
       "hkd": 6960759595539.126,
       "huf": 347613887104448.06,
       "idr": 13743222638186684,
       "ils": 3034149931834.1616,
       "inr": 71539016123488.64,
       "jpy": 123275540920703.75,
       "krw": 1167147442347960.2,
       "kwd": 272511737602.53934,
       "lkr": 326293386032074.1,
       "mmk": 1864531432485947.8,
       "mxn": 17324385506139.879,
       "myr": 4109924276491.056,
       "ngn": 391639591347703.1,
       "nok": 8826367686081.135,
       "nzd": 1451466275213.9624,
       "php": 50877795753434.31,
       "pkr": 196779000043081.25,
       "pln": 4017956116830.191,
       "rub": 53777610889662.375,
       "sar": 3339133401791.7026,
       "sek": 9213304511563.033,
       "sgd": 1219166516334.7983,
       "thb": 31867302155866.453,
       "try": 16496894107240.518,
       "twd": 27631835790487.145,
       "uah": 32792786938908.973,
       "vef": 88930679158.30325,
       "vnd": 22043937448408016,
       "zar": 15312592005270.61,
       "xdr": 660777238766.2579,
       "xag": 40910767987.87886,
       "xau": 501557306.8438745,
       "bits": 52584952994740.92,
       "sats": 5258495299474092
     },
     "total_volume": {
       "btc": 5374453.338415895,
       "eth": 71650852.74579723,
       "ltc": 1517924424.1443553,
       "bch": 902123523.0126519,
       "bnb": 318317114.72026116,
       "eos": 100356170243.42816,
       "xrp": 242448799086.19556,
       "xlm": 978793701482.5006,
       "link": 14133669233.436146,
       "dot": 15911882009.682814,
       "yfi": 15176613.003040742,
       "usd": 90773733754.16634,
       "aed": 333411924079.0531,
       "ars": 14562224645376.775,
       "aud": 135420794701.1533,
       "bdt": 9274059541598.062,
       "bhd": 34151166434.19375,
       "bmd": 90773733754.16634,
       "brl": 483406441734.4374,
       "cad": 120461283378.46674,
       "chf": 85563412210.41112,
       "clp": 80875765825611.83,
       "cny": 645237854271.3679,
       "czk": 2129515484379.2415,
       "dkk": 652073116423.0532,
       "eur": 87512142726.64555,
       "gbp": 76848770675.07576,
       "hkd": 711425522238.2185,
       "huf": 35527931654043.15,
       "idr": 1404628217425284.8,
       "ils": 310105767937.6711,
       "inr": 7311656322490.668,
       "jpy": 12599395924392.34,
       "krw": 119288486738362.5,
       "kwd": 27852104727.790863,
       "lkr": 33348866510130.598,
       "mmk": 190564726432439.1,
       "mxn": 1770641527982.1465,
       "myr": 420055452947.4048,
       "ngn": 40027585636237.195,
       "nok": 902100288675.5294,
       "nzd": 148347337482.6813,
       "php": 5199973065786.218,
       "pkr": 20111828450573.098,
       "pln": 410655832817.16077,
       "rub": 5496349124946.116,
       "sar": 341276651145.2476,
       "sek": 941647227391.5386,
       "sgd": 124605104324.3443,
       "thb": 3257002596827.1445,
       "try": 1686067640243.388,
       "twd": 2824116095066.1245,
       "uah": 3351591913705.937,
       "vef": 9089173960.804653,
       "vnd": 2253004071778410.5,
       "zar": 1565025858837.5608,
       "xdr": 67534840949.496,
       "xag": 4181291435.434076,
       "xau": 51261742.925652824,
       "bits": 5374453338415.895,
       "sats": 537445333841589.44
     },
     "market_cap_percentage": {
       "btc": 36.522483916493655,
       "eth": 17.193146075503307,
       "usdt": 7.586781441149992,
       "bnb": 5.259097923290819,
       "usdc": 4.948555709446785,
       "busd": 2.635496862407305,
       "xrp": 2.115258131797953,
       "doge": 1.4504384823244139,
       "ada": 1.3592366277632495,
       "matic": 0.9698954374591378
     },
     "market_cap_change_percentage_24h_usd": -2.6700637309161057,
     "updated_at": 1668249937
   }
 }
 */


struct GlobalData: Codable {
    let data: MarketData?
}

struct MarketData: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
        
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return item.value.asPercentString()
        }
        return ""
    }
}



